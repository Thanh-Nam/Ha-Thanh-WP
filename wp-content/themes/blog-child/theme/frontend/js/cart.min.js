function cart(a,b){var c=this;this.id=a,this.host=b,this.products=[],this.defaults={gridclass:".table-cart tbody",row:'<tr data-id="">    <td data-field="img"><img class="img-fluid" src=""/></td>    <td data-field="name"><a href=""></a></td>    <td data-field="price" class="text-right money"></td>    <td data-field="quantity"><input type="text" class="form-control number" maxlength="4" value="1"/></td>    <td data-field="subtotal" class="text-right money"></td>    <td data-field="delete"><a class="btn-delete-cart" href="javascript:void(0);"><i class="fa fa-trash"></i></a></td></tr>',rowempty:'<tr><tdcolspan="0"><p class="empty-message">Kh\xf4ng t\xecm th\u1EA5y d\u1EEF li\u1EC7u !</p></td></tr>',rowtotal:".table-cart tfoot",orderclass:".form-order",empty:'<div class="empty-cart">    <p><img src="https://drive.gianhangvn.com/image/empty-cart.jpg" /></p>    <p class="empty-cart-title" data-lang="pc_empty">Hi\u1EC7n t\u1EA1i, Gi\u1ECF h\xe0ng c\u1EE7a b\u1EA1n \u0111ang tr\u1ED1ng</p>    <a class="btn btn-default" title="Ti\u1EBFp t\u1EE5c mua h\xe0ng" href="/san-pham.html" data-lang="pc_success_continue">H\xe3y ti\u1EBFp t\u1EE5c mua h\xe0ng \u2192</a></div>'},this.loadData=function(a,d){if(this.products.length>0){a||(a=this.host);var b=$.map(this.products,function(a,b){return{id:a.id,attrid:a.attrid}});new Ajax(a).postData("/api/productcart",{lang:window.language,ids:b},function(f){if(f.length>0){var b=JSON.parse(f);$(c.id).find(c.defaults.gridclass).html("");for(var a=0;a<b.length;a++){$(c.id).find(c.defaults.gridclass).append(c.defaults.row);var e=$(c.id).find(c.defaults.gridclass).find("[data-id]").last(),g=c.setPrice(b[a].id,b[a].price,b[a].attrid),h=b[a].price*g;e.attr("data-id",b[a].id),e.attr("data-attrid",b[a].attrid),e.find("[data-field]").each(function(){var e=$(this).attr("data-field");switch(e){case"img":$(this).find("img").attr("src",b[a][e]);break;case"name":var f=b[a].url,i=b[a][e];parseInt(b[a].attrid)>0&&(f=f+"?id="+b[a].attrid,i=i+"<br/><i>("+b[a].attrname+")</i>"),$(this).find("a").attr("href",f).html(i);break;case"price":$(this).html(formatNumber(b[a][e]));break;case"quantity":$(this).find("input").val(g).on("focusout change",function(f){var a=parseInt($(this).val());if(!a||a<0){showAlertInfoFocus("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i l\u1EDBn h\u01A1n 0.",this);return}var b=parseInt($(this).closest("[data-id]").attr("data-id")),d=parseInt($(this).closest("[data-id]").attr("data-attrid")),e=c.setQuantity(b,a,d);$(c.id).find(c.defaults.gridclass).find('[data-id="'+b+'"][data-attrid="'+d+'"]').find('[data-field="subtotal"]').html(formatNumber(e*a)),c.showTotal()}).on("keypress",function(a){(13==a.keyCode||13==a.which)&&$(this).trigger("focusout")}).number(!0),$(this).hasClass("spinner")&&($(this).find('input[type="text"]').on("change paste keyup",function(){var a=parseInt($(this).val());isNaN(a)||a<parseInt($(this).attr("min"))?($(this).val($(this).attr("min")),$(this).change()):a>parseInt($(this).attr("max"))&&($(this).val($(this).attr("max")),$(this).change())}),$(this).find(".btn:last-child").on("click touch",function(){var b=$(this),a=b.closest(".spinner").find("input");void 0==a.attr("max")||parseInt(a.val())<parseInt(a.attr("max"))?(a.val(parseInt(a.val(),10)+1),a.change()):b.next("disabled",!0)}),$(this).find(".btn:first-child").on("click touch",function(){var b=$(this),a=b.closest(".spinner").find("input");void 0==a.attr("min")||parseInt(a.val())>parseInt(a.attr("min"))?(a.val(parseInt(a.val(),10)-1),a.change()):b.prev("disabled",!0)}));break;case"subtotal":$(this).html(formatNumber(h));break;case"delete":$(this).find("a").on("click touch",function(){var a=this;showAlertQuestion("vi"==window.language?"B\u1EA1n c\xf3 mu\u1ED1n x\xf3a s\u1EA3n ph\u1EA9m ra kh\u1ECFi gi\u1ECF h\xe0ng hay kh\xf4ng?":ObjLangs.msg_cart_delete,function(f){if(f){var b=$(a).closest("[data-id]"),e=parseInt(b.attr("data-id")),g=parseInt(b.attr("data-attrid"));e>0&&(c.deleteProduct(e,g),c.showTotal(),b.remove(),d&&d(c.countProducts(),c.getSubtotal()))}})})}})}c.showTotal(),c.setLocalStorage(),c.loadOrderInfo()}else c.deleteAll(),c.showEmpty()})}else c.showEmpty()},this.showTotal=function(){var b=this.getSubtotal(),a=parseInt($(this.id).find(this.defaults.rowtotal).find('[data-field="shipping"]').attr("data-value"));(!a||a<0)&&(a=0),$(this.id).find(this.defaults.rowtotal).find('[data-field="subtotal"]').html(formatNumber(b)),$(this.id).find(this.defaults.rowtotal).find('[data-field="total"]').html(formatNumber(b+a))},this.countProducts=function(){return this.products?this.products.length:0},this.getSubtotal=function(){var b=0;if(this.products&&this.products.length>0)for(var a=0;a<this.products.length;a++)this.products[a].price>0&&(b+=this.products[a].price*this.products[a].quantity);return b},this.setPrice=function(d,e,b){b||(b=0);var c=1;if(this.products&&this.products.length>0){for(var a=0;a<this.products.length;a++)if(this.products[a].id==d&&this.products[a].attrid==b){this.products[a].price=parseInt(e),c=this.products[a].quantity,this.setLocalStorage();break}}return c},this.setQuantity=function(d,e,b){b||(b=0);var c=0;if(this.products&&this.products.length>0){for(var a=0;a<this.products.length;a++)if(this.products[a].id==d&&this.products[a].attrid==b){this.products[a].quantity=parseInt(e),c=this.products[a].price,this.setLocalStorage();break}}return c},this.addProduct=function(d,e,g,b){b||(b=0);for(var f=!1,a=0;a<this.products.length;a++)if(this.products[a].id==d&&this.products[a].attrid==b){this.products[a].quantity+=e,f=!0;break}if(!f){var c=parseInt(g);(!c||c<0)&&(c=0),this.products.push({id:d,quantity:e,price:c,attrid:b})}this.setLocalStorage()},this.deleteProduct=function(c,a){a||(a=0);var b=this.products.findIndex(b=>b.id==c&&b.attrid==a);b> -1&&this.products.splice(b,1),this.setLocalStorage(),0==this.products.length&&this.loadData()},this.deleteAll=function(){this.products=[],this.setLocalStorage()},this.saveData=function(){var b=[];if(this.products&&this.products.length>0)for(var a=0;a<this.products.length;a++)b.push({id:this.products[a].id,attrid:this.products[a].attrid,quantity:this.products[a].quantity});if(0==b.length){showAlertInfo(ObjLangs.msg_cart_empty);return}var d={lang:window.language,products:JSON.stringify(b)},e=!0;if($(this.id).find(this.defaults.orderclass).find("[data-field]").each(function(){if(e){var a,b=$(this).attr("data-field"),f=1==parseInt($(this).attr("data-required"));switch(b){case"ReceiveCityId":case"ReceiveDistrictId":if(a=parseInt($(this).val()),f&&(!a||a<0)){c.showAlertSelectEmpty(this),e=!1;return}d[b]=a;break;case"PaymentMethodId":a=parseInt($(this).find("input:checked").val()),d[b]=a;break;case"captcha":if(a=$(this).val().trim(),f&&0==a.length){c.showAlertInputEmpty(this),e=!1;return}d.uid=getUIDCookie(),d.captchacode=$(this).closest(".captcha").find("img").attr("data-id"),d[b]=a;break;default:if(a=$(this).val().trim(),f&&0==a.length){c.showAlertInputEmpty(this),e=!1;return}d[b]=a}}}),e){var f=new Ajax(this.host);$("body").trigger("startLoading"),f.postData("/page/order",d,function(a){if($("body").trigger("stopLoading"),a.status>0){var e=parseInt(a.data);if(e>0){c.deleteAll(),c.setLocalStorageOrderInfo(d);var b=$(c.id).attr("data-url");b&&0!=b.length||(b="/don-hang-thanh-cong.html"),window.location.href=b+"?order="+e}else showAlertInfo(ObjLangs.msg_cart_unsuccess)}else showAlertWarning(a.message),a.data&&a.data.captcha&&a.data.captcha.length>0&&$(c.id).find('.captcha img[data-name="order"]').each(function(){setCaptchaImage(this,a.data.captcha,!1)})})}},this.loadShippingFee=function(b,d){if(window.shippingFee){var a=c.getShippingFee(b,d);$(c.id).find(c.defaults.rowtotal).find('[data-field="shipping"]').attr("data-value",a).html(formatNumber(a)),c.showTotal()}else new Ajax(this.host).getData("/gets/shipping",function(a){if(a.status>0){window.shippingFee=a.data;var e=c.getShippingFee(b,d);$(c.id).find(c.defaults.rowtotal).find('[data-field="shipping"]').attr("data-value",e).html(formatNumber(e)),c.showTotal()}})},this.getShippingFee=function(i,j){var e=0,f=c.getSubtotal();if(window.shippingFee&&window.shippingFee.length>0){if(i>0&&j>0){for(var d,g,h,b,a=0;a<window.shippingFee.length;a++)if(d=parseInt(window.shippingFee[a].CityId),g=parseInt(window.shippingFee[a].DistrictId),h=parseInt(window.shippingFee[a].FromMoney),b=parseInt(window.shippingFee[a].ToMoney),i==d&&j==g&&f>=h&&(f<=b|| -1==b)){e=parseInt(window.shippingFee[a].Price);break}}if(i>0&&0==e){for(var a=0;a<window.shippingFee.length;a++)if(d=parseInt(window.shippingFee[a].CityId),g=parseInt(window.shippingFee[a].DistrictId),h=parseInt(window.shippingFee[a].FromMoney),b=parseInt(window.shippingFee[a].ToMoney),i==d&& -1==g&&f>=h&&(f<=b|| -1==b)){e=parseInt(window.shippingFee[a].Price);break}}if(0==e){for(var a=0;a<window.shippingFee.length;a++)if(d=parseInt(window.shippingFee[a].CityId),g=parseInt(window.shippingFee[a].DistrictId),h=parseInt(window.shippingFee[a].FromMoney),b=parseInt(window.shippingFee[a].ToMoney),(-1==d||64==d)&& -1==g&&f>=h&&(f<=b|| -1==b)){e=parseInt(window.shippingFee[a].Price);break}}}return e},this.loadLocalStorage=function(){var a=getCache("cart");a&&a.length>0&&(this.products=JSON.parse(a)),this.products||(this.products=[])},this.setLocalStorage=function(){addCache("cart",JSON.stringify(this.products))},this.loadLocalStorage(),this.setLocalStorageOrderInfo=function(b){var c={};for(var a in b)switch(a){case"ReceiveName":case"ReceivePhone":case"ReceiveEmail":case"ReceiveAddress":case"CompanyTax":case"CompanyName":case"CompanyAddress":case"ReceiveCityId":case"ReceiveDistrictId":c[a.toLowerCase()]=b[a]}addCache("order",JSON.stringify(c))},this.loadOrderInfo=function(){var a=getCache("order");a&&a.length>0&&(a=JSON.parse(a),$(c.id).find(c.defaults.orderclass).find("[data-field]").each(function(){var c=$(this).attr("data-field"),b=a[c.toLowerCase()];switch(b||(b=""),c){case"ReceiveName":case"ReceivePhone":case"ReceiveEmail":case"ReceiveAddress":case"CompanyTax":case"CompanyName":case"CompanyAddress":$(this).val(b);break;case"ReceiveCityId":case"ReceiveDistrictId":$(this).val(parseInt(b)).trigger("change")}}))},this.showAlertInputEmpty=function(a){"vi"==window.language?showAlertInfoFocus(ObjLangs.msg_invalid+$(a).attr("data-title"),a):showAlertInfoFocus(ObjLangs.msg_invalid+ObjLangs[$(a).attr("data-lang")],a)},this.showAlertSelectEmpty=function(a){"vi"==window.language?showAlertInfoFocus(ObjLangs.msg_invalid_select+$(a).attr("data-title"),a):showAlertInfoFocus(ObjLangs.msg_invalid_select+ObjLangs[$(a).attr("data-lang")],a)},this.showEmpty=function(){$(c.id).html(c.defaults.empty),$(c.id).find("*[data-lang]").each(function(){this.tagName.toLowerCase();var a=ObjLangs[$(this).attr("data-lang")];$(this).html(a)})}}function productAttribute(a){var b=this;this.id=a,this.attributes=[],this.productAttributes=[],this.defaults={attributes:'<div class="product-option attribute" data-id="{0}"><span>{1}</span>{2}</div>',attributelist:'<div class="product-option-list">{0}</div>',attributeItem:'<div class="product-option-item attribute-value" data-parent="{0}" data-id="{1}"><span class="value">{2}</span></div>'},this.compareArrays=function(a,b){return 0==$(a).not(b).length&&0==$(b).not(a).length},this.loadData=function(){for(var a,f="",c=0;c<this.attributes.length;c++){a="";for(var e=JSON.parse(this.attributes[c].value),d=0;d<e.length;d++)a+=this.defaults.attributeItem.format(e[d].parent,e[d].id,e[d].name);a=this.defaults.attributelist.format(a),f+=this.defaults.attributes.format(this.attributes[c].id,this.attributes[c].name,a)}$(this.id).html(f),$(this.id).find(".attribute-value").on("click touch",function(){var c=parseInt($(this).attr("data-id")),a=parseInt($(this).attr("data-parent"));$(b.id).find('.attribute[data-id="'+a+'"]').find(".attribute-value").removeClass("disable active"),$(this).addClass("active"),$(b.id).find(".attribute[data-id]").each(function(){if(parseInt($(this).attr("data-id"))!=a){var d=!0;$(this).find(".attribute-value").each(function(){var a=parseInt($(this).attr("data-id"));b.existedAttributeValues([c,a])?$(this).removeClass("disable"):$(this).addClass("disable").removeClass("active"),$(this).hasClass("active")&&(d=!1)}),d&&$(this).find(".attribute-value:not(.disable)").first().addClass("active")}}),b.showPrice()})},this.showPrice=function(){var b=this.getActiveProductAttribute();if(null!=b){var a=$(this.id).attr("data-target-price"),e=parseInt(b.price),c=parseInt(b.oldprice),f=parseInt(b.discount),d=$(a).attr("data-symbol");$(a).find(".price").html(formatNumber(e)+" "+d),c>0?($(a).find(".old-price").removeClass("none").html(formatNumber(c)+" "+d),$(a).find(".sale-off").removeClass("none").html("-"+f+"%")):($(a).find(".old-price").addClass("none"),$(a).find(".sale-off").addClass("none"));var g=getCurrentUrl()+"?id="+b.id;window.history.replaceState(null,null,g)}},this.setDisableAttributeValueOther=function(a,c){$(b.id).find(".attribute[data-id]").each(function(){parseInt($(this).attr("data-id"))!=a&&$(this).find(".attribute-value").each(function(){var a=parseInt($(this).attr("data-id"));b.existedAttributeValues([c,a])||$(this).addClass("disable").removeClass("active")})})},this.getProductAttributeById=function(b){if(this.productAttributes&&this.productAttributes.length>0){for(var a=0;a<this.productAttributes.length;a++)if(parseInt(this.productAttributes[a].id)==b)return this.productAttributes[a]}return null},this.getActiveProductAttribute=function(){var c=this.getActiveAttributeValues();if(c.length>0&&this.productAttributes&&this.productAttributes.length>0)for(var a=0;a<this.productAttributes.length;a++){var d=JSON.parse(this.productAttributes[a].attributevalues);if(b.compareArrays(d,c))return this.productAttributes[a]}return null},this.existedAttributeValues=function(c){if(this.productAttributes&&this.productAttributes.length>0)for(var a=0;a<this.productAttributes.length;a++){var d=JSON.parse(this.productAttributes[a].attributevalues);if(b.compareArrays(d,c))return!0}return!1},this.resetAttributeValues=function(){$(this.id).find(".attribute-value").removeClass("disable active")},this.setActiveAttributeValues=function(e){this.resetAttributeValues();var c=this.getProductAttributeById(parseInt(e));if(null!=c){for(var d=JSON.parse(c.attributevalues),a=0;a<d.length;a++)$(this.id).find('.attribute-value[data-id="'+d[a]+'"]').addClass("active");$(b.id).find(".attribute[data-id]").each(function(){var a=parseInt($(this).attr("data-id")),c=parseInt($(this).find(".attribute-value.active").attr("data-id"));b.setDisableAttributeValueOther(a,c)})}b.showPrice()},this.getActiveAttributeValues=function(){var a=[];return $(b.id).find(".attribute-value.active").each(function(){a.push(parseInt($(this).attr("data-id")))}),a},this.init=function(a,b){this.attributes=a,this.productAttributes=b}}